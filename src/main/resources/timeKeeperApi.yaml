openapi: 3.0.0
info:
  title: TimeKeeper API
  description: API for managing time entries
  version: 1.0.0
servers:
  - url: http://localhost:8085
paths:
  /training/weekly-summary:
    post:
      summary: AI Weekly Training Summary
      tags: [ AI Training ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WeeklyTrainingRequest'
      responses:
        '200':
          description: Weekly AI analysis
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WeeklyTrainingSummary'
  /register:
    post:
      tags: [ Users ]
      operationId: registration
      summary: Register a new user.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegistrationRequest'
      responses:
        '200':
          description: Successful registration.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserDto'
        '400':
          description: Registration failed (e.g., username or email already taken).
  /login:
    post:
      tags: [ Users ]
      operationId: login
      summary: Authenticate user and return JWT token.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthRequest'
      responses:
        '200':
          description: Successful authentication.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Invalid credentials.
  /items/{id}:
    parameters:
      - $ref: '#/components/parameters/id'
    delete:
      tags: [ Items ]
      operationId: deleteItem
      summary: Delete item from DB by id
      responses:
        '200':
          description: Successful response
    put:
      tags: [ Items ]
      operationId: updateItem
      summary: Update item from DB by id
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ItemDto'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ItemDto'
    get:
      tags: [ Items ]
      operationId: getItem
      summary: Get item from DB by id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ItemDto'
  /items:
    get:
      tags: [ Items ]
      parameters:
        - $ref: '#/components/parameters/pageable'
        - $ref: '#/components/parameters/search'
      operationId: getItems
      summary: Get all items from DB for logged user
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ItemsPaginatedListDto'
    post:
      tags: [ Items ]
      operationId: createItem
      summary: Create new item
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ItemDto'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ItemDto'
  /training-diary/{diaryId}/trainings/{id}:
    parameters:
      - $ref: '#/components/parameters/diaryId'
      - $ref: '#/components/parameters/id'
    delete:
      tags: [ Trainings ]
      operationId: deleteTraining
      summary: Delete training from DB by id
      responses:
        '200':
          description: Successful response
    put:
      tags: [ Trainings ]
      operationId: updateTraining
      summary: Update training from DB by id
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TrainingDto'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrainingDto'
    get:
      tags: [ Trainings ]
      operationId: getTraining
      summary: Get training from DB by id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrainingDto'
  /training-diary/{id}/trainings:
    parameters:
      - $ref: '#/components/parameters/id'
    get:
      tags: [ Trainings ]
      parameters:
        - $ref: '#/components/parameters/pageable'
        - $ref: '#/components/parameters/search'
      operationId: getTrainings
      summary: Get all trainings from DB for logged user
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TrainingDto'
    post:
      tags: [ Trainings ]
      operationId: createTraining
      summary: Create new training
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TrainingDto'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrainingDto'
  /training-diary/{id}/body-measurements:
    parameters:
      - $ref: '#/components/parameters/id'
    get:
      tags: [ BodyMeasurements ]
      parameters:
        - $ref: '#/components/parameters/pageable'
        - $ref: '#/components/parameters/search'
      operationId: getBodyMeasurements
      summary: Get all body measurements from DB for logged user
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BodyMeasurementDto'
    post:
      tags: [ BodyMeasurements ]
      operationId: createBodyMeasurement
      summary: Create new body measurement
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BodyMeasurementDto'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BodyMeasurementDto'
  /training-diary/{diaryId}/body-measurements/{id}:
    parameters:
      - $ref: '#/components/parameters/diaryId'
      - $ref: '#/components/parameters/id'
    delete:
      tags: [ BodyMeasurements ]
      operationId: deleteBodyMeasurement
      summary: Delete body measurement from DB by id
      responses:
        '200':
          description: Successful response
    put:
      tags: [ BodyMeasurements ]
      operationId: updateBodyMeasurement
      summary: Update body measurement from DB by id
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BodyMeasurementDto'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BodyMeasurementDto'
    get:
      tags: [ BodyMeasurements ]
      operationId: getBodyMeasurement
      summary: Get body measurement from DB by id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BodyMeasurementDto'
  /training-diary/{id}:
    parameters:
      - $ref: '#/components/parameters/id'
    put:
      tags: [ TrainingDiary ]
      operationId: updateTrainingDiary
      summary: Update training diary from DB by id
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TrainingDiaryBaseDto'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrainingDiaryDto'
    get:
      tags: [ TrainingDiary ]
      operationId: getTrainingDiary
      summary: Get training diary from DB by id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrainingDiaryDto'
    delete:
      tags: [ TrainingDiary ]
      operationId: deleteTrainingDiary
      summary: Delete training diary from DB by id
      responses:
        '200':
          description: Successful response
  /training-diary:
    post:
      tags: [ TrainingDiary ]
      operationId: createTrainingDiary
      summary: Create new training diary
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TrainingDiaryBaseDto'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrainingDiaryDto'
    get:
      tags: [ TrainingDiary ]
      operationId: getTrainingDiaries
      summary: Get users training diaries from DB by id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TrainingDiaryBaseDto'
  /transactions:
    get:
      tags: [ Transactions ]
      parameters:
        - $ref: '#/components/parameters/pageable'
        - $ref: '#/components/parameters/search'

      operationId: getTransactions
      summary: Get all transactions from DB for logged user
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransactionPaginatedListDto'
    post:
      tags: [ Transactions ]
      operationId: createTransaction
      summary: Create new transaction
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransactionDto'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransactionDto'
  /transactions/{id}:
    parameters:
      - $ref: '#/components/parameters/id'
    delete:
      tags: [ Transactions ]
      operationId: deleteTransaction
      summary: Delete transaction from DB by id
      responses:
        '200':
          description: Successful response
    put:
      tags: [ Transactions ]
      operationId: updateTransaction
      summary: Update transaction from DB by id
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransactionDto'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransactionDto'
    get:
      tags: [ Transactions ]
      operationId: getTransaction
      summary: Get transaction from DB by id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransactionDto'
  /tasks:
    get:
      tags: [ Tasks ]
      parameters:
        - $ref: '#/components/parameters/pageable'
        - $ref: '#/components/parameters/search'

      operationId: getTasks
      summary: Get all tasks from DB for logged user
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskPaginatedListDto'
    post:
      tags: [ Tasks ]
      operationId: createTask
      summary: Create new task
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TaskDto'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskDto'
  /tasks/{id}/done:
    parameters:
      - $ref: '#/components/parameters/id'
    put:
      tags: [ Tasks ]
      operationId: taskDone
      summary: Update task from DB by id to DONE
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskDto'
  /tasks/{id}:
    parameters:
      - $ref: '#/components/parameters/id'
    delete:
      tags: [ Tasks ]
      operationId: deleteTask
      summary: Delete task from DB by id
      responses:
        '200':
          description: Successful response
    put:
      tags: [ Tasks ]
      operationId: updateTask
      summary: Update task from DB by id
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TaskDto'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskDto'
    get:
      tags: [ Tasks ]
      operationId: getTask
      summary: Get task from DB by id
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskDto'
components:
  schemas:
    AuthRequest:
      type: object
      properties:
        username:
          type: string
          description: Username of the user.
          example: "admin"
        password:
          type: string
          description: Password of the user.
          example: "securePassword123"
      required:
        - username
        - password
    AuthResponse:
      type: object
      properties:
        token:
          type: string
          description: JWT token for authentication.
      required:
        - token
    BodyMeasurementDto:
      type: object
      properties:
        id:
          type: integer
          format: int64
        weight:
         type: number
         format: double
        bodyFat:
          type: number
          format: double
        week:
          type: integer
          format: int32
        day:
          type: integer
          format: int32

    RegistrationRequest:
      type: object
      properties:
        name:
          type: string
        surname:
          type: string
        username:
          type: string
          description: Username for the new user.
          example: "newUser"
        password:
          type: string
          description: Password for the new user.
          example: "securePassword123"
        email:
          type: string
          format: email
          description: Email address of the new user.
          example: "newuser@example.com"
      required:
        - username
        - password
        - email
    UserDto:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/Id'
        name:
          type: string
        surname:
          type: string
        username:
          type: string
          description: Username of the user.
        email:
          type: string
          format: email
          description: Email address of the user.
        roles:
          type: array
          items:
            $ref: '#/components/schemas/Role'
    ItemsPaginatedListDto:
      allOf:
        - $ref: '#/components/schemas/Paged'
      properties:
        list:
          type: array
          default: [ ]
          items:
            $ref: '#/components/schemas/ItemDto'
    TrainingPaginatedListDto:
      allOf:
        - $ref: '#/components/schemas/Paged'
      properties:
        list:
          type: array
          default: [ ]
          items:
            $ref: '#/components/schemas/TrainingDto'
    TransactionPaginatedListDto:
      allOf:
        - $ref: '#/components/schemas/Paged'
      properties:
        list:
          type: array
          default: [ ]
          items:
            $ref: '#/components/schemas/TransactionDto'
    TaskPaginatedListDto:
      allOf:
        - $ref: '#/components/schemas/Paged'
      properties:
        list:
          type: array
          default: [ ]
          items:
            $ref: '#/components/schemas/TaskDto'
    TaskDto:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: Unique identifier of the item.
        name:
          type: string
        description:
          type: string
        category:
          type: string
        done:
          type: boolean
        deadline:
          type: string
          format: date-time
    TrainingDiaryBaseDto:
      type: object
      discriminator:
        propertyName: TrainingDiaryBaseDto
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        year:
          type: integer
          format: int32
    TrainingDiaryDto:
      allOf:
        - $ref: "#/components/schemas/TrainingDiaryBaseDto"
      properties:
        trainings:
          type: array
          items:
            $ref: "#/components/schemas/TrainingDto"
        bodyMeasurements:
          type: array
          items:
            $ref: "#/components/schemas/BodyMeasurementDto"
    TrainingDto:
      type: object
      properties:
        id:
          type: integer
          format: int64
        type:
          type: string
        week:
          type: integer
          format: int32
        day:
          type: integer
          format: int32
        name:
          type: string
        note:
          type: string
        exercises:
          type: array
          items:
            $ref: "#/components/schemas/ExerciseDto"
    WeeklyTrainingRequest:
      type: object
      properties:
        weekStart:
          type: string
          format: date
        bodyWeight:
          type: number
          format: double
        strength:
          type: array
          items:
            $ref: '#/components/schemas/StrengthTrainingEntry'
        cardio:
          type: array
          items:
            $ref: '#/components/schemas/CardioTrainingEntry'
        boxing:
          type: array
          items:
            $ref: '#/components/schemas/BoxTrainingEntry'
      required:
        - weekStart
        - bodyWeight
    StrengthTrainingEntry:
      type: object
      properties:
        name:
          type: string
        day:
          type: integer
        week:
          type: integer
        note:
          type: string
        exercises:
          type: array
          items:
            $ref: '#/components/schemas/ExerciseEntry'
    ExerciseEntry:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        set:
          type: integer
        rep:
          type: integer
        duration:
          type: integer
        distance:
          type: number
        speed:
          type: number
        weight:
          type: number

    CardioTrainingEntry:
      type: object
      properties:
        name:
          type: string
        day:
          type: integer
        week:
          type: integer
        duration:
          type: number
        distance:
          type: number
        speed:
          type: number
        note:
          type: string
    BoxTrainingEntry:
      type: object
      properties:
        name:
          type: string
        day:
          type: integer
        week:
          type: integer
        duration:
          type: integer
        note:
          type: string
    WeeklyTrainingSummary:
      type: object
      properties:
        summary:
          type: string
          example: "Tento týden jsi měl výbornou konzistenci v silovém tréninku..."
        progress:
          type: string
          example: "Zlepšil ses v kondici, běh na 5 km byl o 30 sekund rychlejší..."
        recommendations:
          type: string
          example: "Přidej 1× intervalový běh, drž nižší RPE při box sparringu..."
        fatigueRisk:
          type: string
          example: "Střední riziko přetížení – dva box tréninky + deadlift 150 kg..."
        combatAdvice:
          type: string
          example: "Zaměř se na rychlé kombinace 1–2–3, footwork kruhem, hlava více v pohybu."
    ExerciseDto:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        set:
          type: integer
          format: int32
        rep:
          type: integer
          format: int32
        duration:
          type: integer
          format: int32
        distance:
          type: number
          format: double
        speed:
          type: number
          format: double
        weight:
          type: number
          format: double
    TransactionDto:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: Unique identifier of the item.
        type:
          type: string
        category:
          type: string
        description:
          type: string
        transactionDate:
          type: string
          format: date
        user:
          $ref: '#/components/schemas/UserDto'
        amount:
          type: string
          example: "1234.56"
    ItemDto:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: Unique identifier of the item.
        title:
          type: string
          description: Title of the item.
        description:
          type: string
          description: Description of the item.
        validityFrom:
          type: string
          format: date-time
          description: Start date of the item's validity.
        validityTo:
          type: string
          format: date-time
          description: End date of the item's validity.
        user:
          $ref: '#/components/schemas/UserDto'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        createdBy:
          type: string
        updatedBy:
          type: string
    Id:
      type: integer
      format: int64
    Pageable:
      type: object
      properties:
        page:
          type: integer
          description: Page number of the query.
          example: 0
          default: 0
        size:
          type: integer
          description: Page size of the query.
          example: 20
          default: 50
        sort:
          type: string
          description: "Sorting criteria in the format: property(,asc|desc). Default sort order is ascending. Multiple sort criteria are supported."
          example: name,asc

    Paged:
      type: object
      discriminator:
        propertyName: pagedType
      properties:
        count:
          type: integer
          default: 0
          description: Number of filter list items
        totalCount:
          type: integer
          format: int64
          default: 0
          description: Number of all list items
        page:
          type: integer
          default: 1
          description: Page number
        size:
          type: integer
          default: 50
          description: Items per page
    Role:
      type: string
      enum:
        - ADMIN
        - USER
        - GUEST
      description: Roles that a user can have in the system.

  parameters:
    id:
      name: id
      in: path
      required: true
      description: 'Identifier of entity'
      schema:
        $ref: '#/components/schemas/Id'
    diaryId:
      name: diaryId
      in: path
      required: true
      description: 'Identifier of entity'
      schema:
        $ref: '#/components/schemas/Id'
    search:
      in: query
      name: search
      schema:
        type: string
      description: Search parameters for the query.
      example: createdBy:Aston* AND (structureVersion.createdAt<1681391768819 OR createdAt>1681391768819)
    pageable:
      in: query
      name: pageable
      schema:
        $ref: "#/components/schemas/Pageable"